<!DOCTYPE html>
<html>

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="gramatica.js"></script>
    <script src="./Expresiones/Aritmeticas.js"></script>
    <script src="./TabSymEnt/tabSym.js"></script>
    <script src="./Expresiones/Declaracion.js"></script>
    <script src="./Expresiones/Asignacion.js"></script>
    <script src="./Expresiones/IncDec.js"></script>
    <script src="./Expresiones/Imprimir.js"></script>
    <script src="./Expresiones/Si.js"></script>
    <script src="./Expresiones/While.js"></script>
    <script src="./Expresiones/DoWhile.js"></script>
    <script src="./Expresiones/Switch.js"></script>
    <script src="./Expresiones/Caso.js"></script>
    <script src="./Expresiones/For.js"></script>
    <script src="./Expresiones/ParamE.js"></script>
    <script src="./Expresiones/Funcion.js"></script>
    <script src="./Expresiones/LlamarF.js"></script>
    <script src="./Expresiones/Return.js"></script>
    <script src="./Expresiones/objetoRetorno.js"></script>
    <script src="./Expresiones/Breik.js"></script>
    <script src="./Expresiones/Continuar.js"></script>
    <script src="./Expresiones/DecArreglo.js"></script>
    <script src="./Expresiones/AccesoMatrix.js"></script>
    <script src="./Expresiones/Graficar.js"></script>
    <script src="./Expresiones/ParamTipo.js"></script>
    <script src="./Expresiones/Tipo.js"></script>
    <script src="./Expresiones/AccesoAt.js"></script>
    <script src="./Expresiones/Error.js"></script>
    <script src="parser.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>

</head>

<body>
    <script>
        var contadorLinea = 0;
        var contadorColumna = 1;
        var pila = [];
        var Horrores = [];



    </script>
    <div id="container">
        <div class="form-group green-border-focus">

            <textarea class="form-control" id="texto" rows="10" onkeydown="processe(event, this)"
                onkeypress="process(event, this)"></textarea>
            <h6>Fila <span id="spam" class="label label-default">0</span></h6>
            <h6>Columna <span class="label label-default" id="columna">0</span></h6>
        </div>
        <button type="button" class="btn btn-primary btn-lg btn-block" onclick="analizando()">Analizar</button>
        <button type="button" class="btn btn-primary btn-lg btn-block" onclick="cursor()">Cursor</button>

    </div>
    <div class="jumbotron text-center" id="bootstrapStyle">
        <h1>Primer Proyecto Compi2</h1>
        <p>Byron David Cermeño Juárez - 201313734</p>
        <textarea class="form-control" id="consola" rows="10"></textarea>


    </div>
    <div>
        <h1>CONSOLA</h1>

    </div>
    <div>

    </div>
    <script>
        function crearErrores(tablas) {
            if (tablas.length > 0) {

                var body = document.body;

                tbl = document.createElement('table');
                tbl.id = "errorsitos";
                tbl.style.width = '300px';
                //tbl.style.border = '1px solid black';
                tbl.style.text = 'center';
                var tr = tbl.insertRow();
                var td = tr.insertCell();
                td.appendChild(document.createTextNode("TIPO"));
                var tdx = tr.insertCell();
                tdx.appendChild(document.createTextNode("EXPLICACION"));
                var tdxdd = tr.insertCell();
                tdxdd.appendChild(document.createTextNode("FILA"));
                var tdxd = tr.insertCell();
                tdxd.appendChild(document.createTextNode("COLUMNA"));
                //tdx.appendChild(document.createTextNode(tablas[0].Arreglo[0].id));
                for (let i = 0; i < tablas.length; i++) {//total de tablas a imprimir
                    var tr = tbl.insertRow();
                    var td = tr.insertCell();
                    td.appendChild(document.createTextNode(tablas[i].tipo));
                    var td = tr.insertCell();
                    td.appendChild(document.createTextNode(tablas[i].error));
                    var td = tr.insertCell();
                    td.appendChild(document.createTextNode(tablas[i].fila));
                    var td = tr.insertCell();
                    td.appendChild(document.createTextNode(tablas[i].columna));
                    

                }
                body.appendChild(tbl);
                tbl.setAttribute("border", "2");

            }
        }
        function crearTabs(tablas) {
            if (tablas.length > 0) {

                var body = document.body;
                //var tablavieja = document.getElementById("tablita");
                //tablavieja.remove();
                //document.getElementById("tablita").outerHTML = "";
                tbl = document.createElement('table');
                tbl.id = "tablita";
                tbl.style.width = '300px';
                //tbl.style.border = '1px solid black';
                tbl.style.text = 'center';
                var tr = tbl.insertRow();
                var td = tr.insertCell();
                td.appendChild(document.createTextNode("ID"));
                var tdx = tr.insertCell();
                tdx.appendChild(document.createTextNode("TIPO"));
                var tdxdd = tr.insertCell();
                tdxdd.appendChild(document.createTextNode("TIPODATO"));
                var tdxd = tr.insertCell();
                tdxd.appendChild(document.createTextNode("VALOR/CANTIDAD"));
                //tdx.appendChild(document.createTextNode(tablas[0].Arreglo[0].id));
                for (let i = 0; i < tablas.length; i++) {//total de tablas a imprimir
                    var tr = tbl.insertRow();
                    var td = tr.insertCell();
                    td.appendChild(document.createTextNode("Tabla#" + (i + 1)));
                    for (let j = 0; j < tablas[i].Symbol.length; j++) {
                        if (tablas[i].Symbol.length > 0) {
                            var tr = tbl.insertRow();
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode(tablas[i].Symbol[j].id));
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode(tablas[i].Symbol[j].tipo));
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode("SIMBOLO"));
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode(tablas[i].Symbol[j].value));
                        }
                    }
                    for (let a = 0; a < tablas[i].Arreglo.length; a++) {
                        if (tablas[i].Arreglo.length > 0) {
                            var tr = tbl.insertRow();
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode(tablas[i].Arreglo[a].id));
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode(tablas[i].Arreglo[a].tipo));
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode("ARRAY"));
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode(tablas[i].Arreglo[a].valsdim.length));
                        }

                    }
                    for (let x = 0; x < tablas[i].Tipo.length; x++) {
                        if (tablas[i].Tipo.length > 0) {
                            let sim = tablas[i].Tipo[x].params.Symbol.length;
                            let tip = tablas[i].Tipo[x].params.Tipo.length;
                            let total = sim + tip;
                            var tr = tbl.insertRow();
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode(tablas[i].Tipo[x].id));
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode(tablas[i].Tipo[x].tipo));
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode("TYPE"));
                            var td = tr.insertCell();
                            td.appendChild(document.createTextNode(total + " ELEMENTOS"));
                        }
                    }

                }
                body.appendChild(tbl);
                tbl.setAttribute("border", "2");

            }
        }

        function analizando() {
            var veremos = document.getElementById("tablita");
            if (veremos) {
                veremos.remove();
            }
            var ver = document.getElementById("errorsitos");
            if (ver) {
                ver.remove();
            }
            Horrores = [];
            let HorroresLexico = new Array();
            window.consola = new Array();//mensajes en mi consola
            window.tablas = new Array();//tablas a imprimir 
            var x = document.getElementById("texto").value;
            Compilar(x);
            probador = window.tablas;
            var y = "";
            document.getElementById("consola").value = "";
            for (let i = 0; i < consola.length; i++) {
                y += consola[i];
                y += "\n";
            }
            document.getElementById("consola").value = y;
            crearTabs(tablas);
            crearErrores(Horrores);
            //EMPIEZO A CREAR LA TABLA


            //TERMINO DE CREAR LA TABLA


            //var parser = require('./gramatica');


            //var parse = gramatica.parse(x);
            //alert(parse);
            //document.getElementById("demo").innerHTML = x;
            //console.log(x.toString());
            //alert(x.toString());
        }
        function cursor() {
            var textarea = document.getElementById("texto");
            var spammm = document.getElementById("spam");
            textarea.focus();
            //alert(textarea.selectionStart);
            var posicionh = textarea.selectionStart;
            document.getElementById("spam").innerHTML = textarea.selectionStart;


        }
        function processe(e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 8) {
                if (contadorLinea == 0 && contadorColumna > 0) {
                    if (pila.length > 0) {//si la pila tiene valores
                        //alert("LA PILA TODAVIA TIENE MAS DE 1 VALOR, TIENE--> " + pila.length);


                        contadorLinea = pila[pila.length - 1];
                        document.getElementById("spam").innerHTML = contadorLinea;
                        pila.pop();
                    }
                    else {
                        //alert("LA PILA NO TIENE MAS DE 1 VALOR");

                    }
                    contadorColumna = contadorColumna - 1;
                    document.getElementById("columna").innerHTML = contadorColumna;

                }
                else if (contadorLinea > 0) {
                    contadorLinea = contadorLinea - 1;
                    document.getElementById("spam").innerHTML = contadorLinea;
                }
            }
        }

        function process(e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if (code == 13) { //Enter keycode
                pila.push(contadorLinea);
                //alert("Guardando en la pila el valor --> " + contadorLinea);
                contadorLinea = 0;
                document.getElementById("spam").innerHTML = contadorLinea;
                contadorColumna = contadorColumna + 1;
                document.getElementById("columna").innerHTML = contadorColumna;

            }
            else {
                contadorLinea = contadorLinea + 1;
                document.getElementById("spam").innerHTML = contadorLinea;


            }
        }

    </script>


</body>

</html>